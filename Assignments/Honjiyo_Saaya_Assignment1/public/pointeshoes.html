<script src="./product_data.js" type="text/javascript"></script>

<script>
    // Modified from Lab 12, function to check valid quantity
    function isNonNegInt(qty, return_errors = false) { //check if values are postitive, integer, whole values 
    errors = []; // assume no errors at first
    if (qty == '') qty = 0; //sets input quantity as 0 
    if (Number(qty) != qty) errors.push(' <b>Please change to a number</b>'); // Check if string is a number value
    else if (qty < 0) errors.push('<b>Please change to a positive integer</b>'); // Check if it is non-negative
    else if (parseInt(qty) != qty) errors.push('<b>Please change to a full value</b>'); // Check that it is an integer
    return return_errors ? errors : (errors.length == 0);
}
    // Checks textbox for valid quantity, Lab12
    function checkQuantityTextbox(purchase_qty) {
        // Checks textbox to see if it is a valid integer
        errs = isNonNegInt(purchase_qty.value, true);
        // Allows amount adjustment
        if (errs.length == 0) errs = ['quantity'];
        if (purchase_qty.value.trim() == '') errs = ['quantity'];
        document.getElementById(purchase_qty.name + '_label').innerHTML = errs.join(' , ');
    }
    // Uses quantity from page
    window.onload =  function () {
        // Checks quantity to checkout at invoice
        let params = (new URL(document.location)).searchParams;
        if (params.has('submit_purchase')) {
            // Checks number input
            is_error = false;
            // Checks any 0's
            total_qty = 0;
            // Array image and price 
            for (i = 0; i < products.length; i++) {
                if (params.has(`quantity${i}`)) {
                    a_qty = params.get(`quantity${i}`);
                    product_form[`quantity${i}`].value = a_qty;
                    total_qty += a_qty;
                    if (!isNonNegInt(a_qty)) {
                        is_error = true; 
                        // Finds errors
                        checkQuantityTextbox(product_form[`quantity${i}`]); 
                        }   
                    }
                }
                // Look for errors, if not redirect to invoice
                // Alert if error
                if (is_error) {
                    alert("Please enter valid quantity");
                } else if (total_qty == 0) {
                // Alert if no quantity error
                    alert("Please enter a quantity");
                } else { 
                // No Errors, redirect to invoice
                    window.location = `./invoice.html${document.location.search}`;
                    window.stop;
                }
            }
        }
        </script>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pointe Shoe Display</title>
    <link rel="stylesheet" href="./css/productdisplay.css">
    <link href="https://fonts.googleapis.com/css2?family=Abril+Fatface&display=swap" rel="stylesheet">
</head>

<body>
            <!-- Order Form -->
            <center>
                <h1>Order Here!</h1>
            </center>
            <form name="order_form" action="./process_form" method="POST"></form>
            <center>
                <p>Order your pointe shoes by entering a quantity in the textbox and press "Purchase" at the bottom of
                    the page! Be aware of the limited quantity.</p>
            </center>
            <!-- From SmartPhoneProducts WODs, modified formatting, displays products-->
                <main>
                    <form name="quantity_form" action="./process_form" method="post">
                    <div>                    
                        <script>
                        for(i=0; i < products.length; i++) {
                           document.write(`
       <section class="item">
           <center><img src=${products[i].image}></center>
           <font color = "#6d6d5f"> <center><h2>${products[i].name}</h2></center></font>
           <center><p>$${products[i].price} ~ Quantity Available:${products[i].quantity}</p></center>
           <center><input type= "text" size="2" placeholder="0" name= "quantity_textbox${i}" onkeyup="checkQuantityTextbox(this)"><span id="quantity_textbox${i}_message"></span></center>
       </section>
       `);
                       }
                   </script>
               </main></div>

                <!-- Purchase button-->
                <center><input type="submit" class="button" value="Purchase" id="submit" name="purchase_submit"></center>
            </div>
            </form>
            </script>

</body>

</html>